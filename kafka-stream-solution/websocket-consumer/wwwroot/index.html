<!DOCTYPE html>
<html>
<head>
    <title>Trending Topics</title>
    <style>
        body {
            font-family: 'Montserrat', sans-serif;
            background-color: #F2F2F2; /* Cloud colour */
            color: #0A0019; /* Carbon colour */
            text-align: center;
            margin: 0;
            padding: 0;
        }

        h1 {
            font-family: 'Syne', sans-serif;
            font-weight: bold;
            font-size: 2.5em;
            color: #24004C; /* Midnight colour */
            margin-top: 20px;
        }

        #topicsContainer {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin: 20px;
        }

        .topic-card {
            position: relative;
            padding: 20px;
            padding-bottom: 80px; 
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            text-align: left;
            width: 280px;
            margin-bottom: 20px;
            transition: box-shadow 0.2s;
            border-left: 10px solid transparent;
        }

        .topic-card:hover {
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .topic-card.top-1 {
            border-left-color: #FFD700; /* Gold for top relevance */
        }

        .topic-card.top-2 {
            border-left-color: #C0C0C0; /* Silver for second relevance */
        }

        .topic-card.top-3 {
            border-left-color: #CD7F32; /* Bronze for third relevance */
        }

        .topic-title {
            font-family: 'Syne', sans-serif;
            font-weight: bold;
            font-size: 1.5em;
            margin-bottom: 10px;
            color: #24004C; /* Midnight colour */
        }

        .mentions-count {
            font-size: 1em;
            color: #24004C; /* Midnight colour */
            margin-bottom: 10px;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            border-radius: 5px;
            background-color: #E2E2E2; /* Light grey for the empty part */
            margin-top: 15px;
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            background-color: #C4FF35;
            border-radius: 5px 0 0 5px;
        }

        .sentiment-heart {
            position: absolute;
            bottom: 10px;
            right: 10px;
            width: 80px; 
            height: 80px; 
            font-size: 2.5em; 
            color: #FFFFFF;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .sentiment-5 { color: #28a745; } /* Green for very positive */
        .sentiment-4 { color: #85e085; } /* Light green for positive */
        .sentiment-3 { color: #FFC107; } /* Amber for neutral */
        .sentiment-2 { color: #fd7e14; } /* Orange for negative */
        .sentiment-1 { color: #dc3545; } /* Red for very negative */

        .sentiment-score {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #FFFFFF;
            font-weight: bold;
            font-size: 0.5em; 
        }

    </style>
    <link href="https://fonts.googleapis.com/css2?family=Syne:wght@700&family=Montserrat:wght@300;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
<h1>Trending Topics</h1>
<div id="topicsContainer"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/6.0.1/signalr.min.js"></script>
<script>
    const connection = new signalR.HubConnectionBuilder()
        .withUrl("/trendHub")
        .build();

    connection.on("ReceiveTrendingTopics", (topics) => {
        console.log("Received trending topics data:", topics);

        const topicsContainer = document.getElementById("topicsContainer");
        topicsContainer.innerHTML = "";

        topics.forEach((topic, index) => {
            const topicCard = document.createElement("div");
            topicCard.classList.add("topic-card");

            if (index === 0) {
                topicCard.classList.add("top-1");
            } else if (index === 1) {
                topicCard.classList.add("top-2");
            } else if (index === 2) {
                topicCard.classList.add("top-3");
            }

            const titleDiv = document.createElement("div");
            titleDiv.classList.add("topic-title");
            titleDiv.textContent = topic.theme;

            const mentionsDiv = document.createElement("div");
            mentionsDiv.classList.add("mentions-count");
            mentionsDiv.textContent = `Mentions: ${topic.mentions}`;

            const progressBar = document.createElement("div");
            progressBar.classList.add("progress-bar");

            const progressBarFill = document.createElement("div");
            progressBarFill.classList.add("progress-bar-fill");
            const maxMentions = Math.max(...topics.map(topic => topic.mentions));
            progressBarFill.style.width = `${(topic.mentions / maxMentions) * 100}%`;

            // Create sentiment heart icon with score
            const sentimentHeart = document.createElement("div");
            sentimentHeart.classList.add("sentiment-heart");

            // Use a Font Awesome heart icon
            const heartIcon = document.createElement("i");
            heartIcon.classList.add("fas", "fa-heart");

            // Apply appropriate sentiment colour
            if (topic.averageSentiment === 5) {
                sentimentHeart.classList.add("sentiment-5");
            } else if (topic.averageSentiment === 4) {
                sentimentHeart.classList.add("sentiment-4");
            } else if (topic.averageSentiment === 3) {
                sentimentHeart.classList.add("sentiment-3");
            } else if (topic.averageSentiment === 2) {
                sentimentHeart.classList.add("sentiment-2");
            } else if (topic.averageSentiment === 1) {
                sentimentHeart.classList.add("sentiment-1");
            }

            sentimentHeart.appendChild(heartIcon);

            // Add sentiment score inside the heart
            const sentimentScore = document.createElement("span");
            sentimentScore.classList.add("sentiment-score");
            sentimentScore.textContent = topic.averageSentiment;

            sentimentHeart.appendChild(sentimentScore);
            progressBar.appendChild(progressBarFill);
            topicCard.appendChild(titleDiv);
            topicCard.appendChild(mentionsDiv);
            topicCard.appendChild(progressBar);
            topicCard.appendChild(sentimentHeart);
            topicsContainer.appendChild(topicCard);
        });
    });

    connection.onclose(() => {
        console.error("SignalR connection lost. Reconnecting...");
        connection.start().catch(err => console.error("Error reconnecting:", err));
    });

    connection.start().then(() => {
        console.log("SignalR connection established.");
        connection.invoke("SendTrendingTopics").then(() => {
            console.log("Requested initial trending topics data.");
        }).catch(err => console.error("Error invoking SendTrendingTopics:", err));
    }).catch(err => console.error("Error starting SignalR connection:", err));
</script>
</body>
</html>
